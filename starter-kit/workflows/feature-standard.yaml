# Feature Standard Workflow
# Standard workflow: spec → plan → tasks → analyze → implement
# Inspired by github/spec-kit methodology

name: feature-standard
displayName: "Standard Feature"
description: "Standard feature workflow: specification → plan → tasks → analysis → implementation"

metadata:
  version: "4.0"
  author: "Spec-Kit"
  tags:
    - feature
    - specification
    - standard

template: functional-spec.md
defaultAgent: SpecAgent

steps:
  # Step 1: Create Specification
  - id: create-spec
    name: "1. Create Specification"
    action: call_agent
    agent: SpecAgent
    description: |
      Create a functional specification based on user requirements.
      
      Include:
      - Feature summary and objectives
      - User stories with acceptance criteria
      - Functional requirements (with IDs: FR-001, FR-002...)
      - Non-functional requirements (if applicable)
      - Dependencies and constraints
      
      Quality checks:
      - No implementation details (tech stack, APIs)
      - Focused on user value and business needs
      - Maximum 3 [NEEDS CLARIFICATION] markers
      
      Mark unclear sections with [NEEDS CLARIFICATION] for review.
    inputs:
      - name: requirements
        description: "Feature description from user"
        required: true
    outputs:
      - spec_document

  # Step 2: Create Implementation Plan
  - id: create-plan
    name: "2. Create Implementation Plan"
    action: call_agent
    agent: PlanAgent
    description: |
      Create a detailed implementation plan based on the specification.
      
      Include:
      - Technical approach and architecture
      - Components to create/modify
      - Dependencies and order
      - Risk assessment
      - Estimated effort per phase
    inputs:
      source: "spec_document"
    outputs:
      - plan_document

  # Step 3: Generate Task Breakdown
  - id: generate-tasks
    name: "3. Generate Tasks"
    action: call_agent
    agent: PlanAgent
    description: |
      Break down the plan into atomic, actionable tasks.
      
      Each task should:
      - Be completable in 1-2 hours
      - Have clear acceptance criteria
      - Be independent when possible
      - Include file paths if known
      - Map to specific requirements (FR-001, etc.)
    inputs:
      source: "plan_document"
    outputs:
      - tasks_document

  # Step 4: Analyze Cross-Artifact Consistency (NEW)
  - id: analyze
    name: "4. Analyze Consistency"
    action: call_tool
    tool: speckit_analyze
    description: |
      Perform cross-artifact consistency analysis.
      
      Checks:
      - Duplication detection
      - Ambiguity detection (vague terms)
      - Coverage gaps (requirements ↔ tasks)
      - Constitution alignment
      - Terminology consistency
      
      If CRITICAL issues found, resolve before proceeding.
    inputs:
      source: "tasks_document"
    outputs:
      - analysis_report
    # Require approval if critical issues found
    requiresApproval: true
    approvalMessage: "⚠️ Review analysis findings before implementation"

  # Step 5: Implement
  - id: implement
    name: "5. Implement"
    action: call_agent
    agent: SpecAgent
    description: |
      Implement the tasks one by one.
      
      For each task:
      - Read the task description
      - Implement following project conventions
      - Update task status when complete
      - Auto-enrich memory with decisions/learnings
      - Proceed to next task
    inputs:
      source: "tasks_document"
    outputs:
      - implementation
