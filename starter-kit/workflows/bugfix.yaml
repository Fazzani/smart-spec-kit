# Bugfix Workflow
# Structured process for bug fixes

name: bugfix
displayName: "Bug Fix"
description: "Structured workflow for analyzing, fixing, and validating bug corrections"

metadata:
  version: "3.0"
  author: "Spec-Kit"
  tags:
    - bugfix
    - hotfix
    - correction

template: bugfix-report.md
defaultAgent: SpecAgent

steps:
  # Step 1: Analyze Bug
  - id: analyze-bug
    name: "1. Analyze Bug"
    action: call_agent
    agent: SpecAgent
    description: |
      Analyze the bug based on user description:
      
      - Understand the symptoms
      - Identify reproduction steps
      - Locate affected components
      - Determine root cause
      
      Document findings clearly.
    inputs:
      bug_description: "Description from user"
    outputs:
      - root_cause_analysis

  # Step 2: Plan Fix
  - id: plan-fix
    name: "2. Plan Correction"
    action: call_agent
    agent: PlanAgent
    description: |
      Create a correction plan:
      
      - Proposed fix approach
      - Files/components to modify
      - Potential side effects
      - Test cases to verify fix
      
      Keep the fix minimal and focused.
    inputs:
      source: "root_cause_analysis"
    outputs:
      - fix_plan
    # Require approval before implementing the fix
    requiresApproval: true
    approvalMessage: "Review the fix plan before applying changes"

  # Step 3: Implement Fix
  - id: implement-fix
    name: "3. Implement Fix"
    action: call_agent
    agent: SpecAgent
    description: |
      Implement the bug fix:
      
      - Make minimal changes
      - Follow project conventions
      - Add/update tests
      - Document the fix
    inputs:
      source: "fix_plan"
    outputs:
      - implementation

  # Step 4: Verify
  - id: verify-fix
    name: "4. Verify Fix"
    action: review
    agent: GovAgent
    # Use subagent for independent verification
    useSubagent: true
    description: |
      Verify the fix is complete:
      
      - [ ] Bug is resolved
      - [ ] No regressions introduced
      - [ ] Tests pass
      - [ ] No security issues
    inputs:
      source: "implementation"
    outputs:
      - verification_report
