# Feature Full Workflow
# Complete workflow with validation checkpoints and supporting documents
# Inspired by github/spec-kit methodology

name: feature-full
displayName: "Feature with Validation"
description: "Complete feature workflow with checklists, analysis, security/RGPD validations, and full documentation"

metadata:
  version: "5.0"
  author: "Spec-Kit"
  tags:
    - feature
    - governance
    - validation
    - checklist
    - contracts

template: functional-spec.md
defaultAgent: SpecAgent

# Supporting documents generated during plan phase
supportingDocuments:
  - data-model.md       # Entity definitions, relations, validation
  - contracts/api.yaml  # OpenAPI spec for REST APIs
  - contracts/events.md # WebSocket/event contracts (if real-time)
  - quickstart.md       # Manual validation scenarios
  - research.md         # Technical research (optional)

steps:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 1: SPECIFICATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: create-spec
    name: "1. Create Specification"
    action: call_agent
    agent: SpecAgent
    description: |
      Create a comprehensive functional specification.
      
      Include:
      - Feature summary and objectives
      - User stories with acceptance criteria
      - Functional requirements (with IDs: FR-001, FR-002...)
      - Non-functional requirements
      - Data requirements
      - Dependencies and constraints
      
      Quality checks:
      - No implementation details (tech stack, APIs)
      - All requirements testable and unambiguous
      - Maximum 3 [NEEDS CLARIFICATION] markers
      
      Mark unclear sections with [NEEDS CLARIFICATION] for review.
    inputs:
      - name: requirements
        description: "Feature description from user"
        required: true
    outputs:
      - spec_document

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 2: QUALITY CHECKLIST (NEW)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: requirements-checklist
    name: "2. Requirements Quality Checklist"
    action: call_tool
    tool: speckit_checklist
    description: |
      Generate a requirements quality checklist - "unit tests for English".
      
      Validates:
      - Requirement Completeness
      - Requirement Clarity (no vague terms)
      - Requirement Consistency
      - Acceptance Criteria Quality
      - Scenario Coverage
      - Edge Case Coverage
      
      Fix any [Gap] items before proceeding.
    inputs:
      checklistType: "requirements"
      source: "spec_document"
    outputs:
      - requirements_checklist
    requiresApproval: true
    approvalMessage: "Review requirements quality checklist before validation phase"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 3: VALIDATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: security-review
    name: "3.1 ğŸ”’ Security Review"
    action: review
    agent: GovAgent
    useSubagent: true
    description: |
      Security assessment based on the specification:
      
      **Authentication & Authorization**
      - [ ] Auth mechanism defined
      - [ ] Role-based access control
      - [ ] Session management
      
      **Data Protection**
      - [ ] Encryption requirements
      - [ ] Sensitive data handling
      
      **Input/Output Security**
      - [ ] Input validation strategy
      - [ ] Output encoding
      - [ ] Injection prevention
      
      Identify any security concerns and recommendations.
    inputs:
      spec: "spec_document"
    outputs:
      - security_report

  - id: rgpd-review
    name: "3.2 ğŸ›¡ï¸ RGPD Review"
    action: review
    agent: GovAgent
    # Use subagent for isolated context during RGPD analysis
    useSubagent: true
    description: |
      GDPR/RGPD compliance check:
      
      **Data Collection**
      - [ ] Personal data identified
      - [ ] Legal basis for processing
      - [ ] Data minimization applied
      
      **User Rights**
      - [ ] Right to access
      - [ ] Right to rectification
      - [ ] Right to erasure
      
      **Governance**
      - [ ] Data retention period
      - [ ] Third-party processors
      - [ ] Privacy by design
    inputs:
      spec: "spec_document"
    outputs:
      - rgpd_report
    # Require approval after validations before planning
    requiresApproval: true
    approvalMessage: "Review validation results before creating implementation plan"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 4: PLANNING
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: create-plan
    name: "4. Create Implementation Plan"
    action: call_agent
    agent: PlanAgent
    description: |
      Create a detailed implementation plan incorporating validation feedback.
      
      **Phase -1 Gates (MANDATORY)**:
      - Simplicity Gate (Article VII): â‰¤3 projects, no future-proofing
      - Anti-Abstraction Gate (Article VIII): Use framework directly
      - Integration-First Gate (Article IX): Contracts before code
      - Test-First Gate (Article III): Tests derived from spec
      
      **Main Plan** (plan.md):
      - Technical approach
      - Components to create/modify
      - Security measures to implement (from security_report)
      - RGPD compliance measures (from rgpd_report)
      - Dependencies and order
      - Risk assessment
      
      **Supporting Documents** (generate all applicable):
      - data-model.md: Entity definitions from spec
      - contracts/api.yaml: OpenAPI 3.0 for all endpoints
      - contracts/events.md: Real-time events (if applicable)
      - quickstart.md: Validation scenarios from user stories
      - research.md: Technical comparisons (if decisions needed)
    inputs:
      spec: "spec_document"
      reviews: ["security_report", "rgpd_report"]
    outputs:
      - plan_document
      - data_model
      - api_contracts
      - quickstart_scenarios

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 5: TASKS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: generate-tasks
    name: "5. Generate Tasks"
    action: call_agent
    agent: PlanAgent
    description: |
      Break down the plan into atomic tasks using ALL supporting documents.
      
      **Input Sources**:
      - plan.md (required) - Phases, architecture
      - data-model.md - Entity CRUD tasks, migrations
      - contracts/api.yaml - Endpoint implementation tasks
      - contracts/events.md - Event handler tasks (if exists)
      - quickstart.md - Validation test tasks
      - security_report - Security implementation tasks
      - rgpd_report - RGPD compliance tasks
      
      **Task Format**: `- [ ] T### [P] [US#] Description with file path`
      
      Each task should:
      - Be completable in 1-2 hours
      - Have clear acceptance criteria
      - Include security/RGPD considerations where relevant
      - Be independently testable
    inputs:
      source: "plan_document"
      supportingDocs: ["data_model", "api_contracts", "quickstart_scenarios"]
      validationReports: ["security_report", "rgpd_report"]
    outputs:
      - tasks_document

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 6: CROSS-ARTIFACT ANALYSIS (NEW)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: analyze
    name: "6. Cross-Artifact Analysis"
    action: call_tool
    tool: speckit_analyze
    description: |
      Analyze all artifacts for consistency and completeness.
      
      Verifies:
      - Spec â†’ Plan traceability (all requirements covered)
      - Plan â†’ Tasks traceability (all components have tasks)
      - Validation findings addressed in plan
      - Security/RGPD measures reflected in tasks
      
      Identify any gaps or inconsistencies before implementation.
    inputs:
      focusArea: "full-traceability"
    outputs:
      - analysis_report
    # Critical checkpoint before implementation
    requiresApproval: true
    approvalMessage: "âš ï¸ Implementation will begin after approval. Review analysis report carefully."

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PHASE 7: IMPLEMENTATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - id: implement
    name: "7. Implement"
    action: call_agent
    agent: SpecAgent
    description: |
      Implement the tasks following security and RGPD guidelines.
      
      For each task:
      - Implement following project conventions
      - Apply security measures
      - Ensure RGPD compliance
      - Write appropriate tests
      - Update task status when complete
    inputs:
      source: "tasks_document"
    outputs:
      - implementation
